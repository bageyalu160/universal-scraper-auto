name: ä»ªè¡¨ç›˜æ›´æ–°
run-name: 'ğŸ“Š ä»ªè¡¨ç›˜æ›´æ–° #${{ github.run_number }} (${{ github.actor }})'
on:
  workflow_call: {}
  workflow_dispatch:
    inputs:
      date:
        description: æ•°æ®æ—¥æœŸ (ç•™ç©ºåˆ™ä½¿ç”¨å½“å‰æ—¥æœŸ)
        required: false
        type: string
permissions:
  contents: write
  id-token: write
  pages: write
jobs:
  build:
    name: æ„å»ºä»ªè¡¨ç›˜
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      - name: è®¾ç½®Python
        uses: actions/setup-python@v4
        with:
          cache: pip
          python-version: '3.10'
      - name: å®‰è£…ä¾èµ–
        run: pip install pandas pyyaml requests beautifulsoup4 jinja2
      - id: set-date
        name: è®¾ç½®æ—¥æœŸ
        run: |
          if [ -n "${{ github.event.inputs.date }}" ]; then
            echo "date=${{ github.event.inputs.date }}" >> $GITHUB_OUTPUT
          else
            echo "date=$(date +%Y-%m-%d)" >> $GITHUB_OUTPUT
          fi
      - name: ç”Ÿæˆä»ªè¡¨ç›˜
        run: |
          python scripts/dashboard_generator.py \
            --date "${{ steps.set-date.outputs.date }}" \
            --data-dir "data" \
            --analysis-dir "analysis" \
            --output-dir "dashboard"
      - name: è®¾ç½®Pages
        uses: actions/configure-pages@v3
      - name: ä¸Šä¼ Pagesæ„å»ºäº§ç‰©
        uses: actions/upload-pages-artifact@v2
        with:
          path: dashboard
  deploy:
    name: éƒ¨ç½²ä»ªè¡¨ç›˜
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - id: deployment
        name: éƒ¨ç½²åˆ°GitHub Pages
        uses: actions/deploy-pages@v2
