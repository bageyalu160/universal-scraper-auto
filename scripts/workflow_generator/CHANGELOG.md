# 工作流生成器更新日志

## 版本 2.1.0 (待发布)

### 重大变化

1. **增强型 Jsonnet 生成器**
   - 引入增强型 Jsonnet 生成器，支持更复杂的分析工作流和多 AI 供应商，提升灵活性和可扩展性。
   - 工作流对象自动增强，支持触发条件、并发控制、作业定义等高级特性。
   - 扩展参数库，支持多种输出格式、缓存、通知等。

### 新功能

1. **命令行工具升级**
   - CLI 工具支持批量生成、更新、试运行等多种命令，支持 Jinja2/Jsonnet 双引擎。
   - 支持一键生成/更新所有站点的多类型工作流。
   - 新增仪表盘和代理池管理等通用工作流的生成与更新。

### 技术改进

1. **模板与验证流程优化**
   - 模板预处理和渲染流程优化，自动标准化条件表达式和环境变量引用。
   - 多重验证机制（JSON Schema、actionlint、格式警告），自动修复常见格式问题。
   - 错误处理和日志输出更细致，便于定位和维护。

### 代码结构与文档

1. **结构优化与文档增强**
   - 进一步模块化，类型注解和文档增强，提升可维护性和扩展性。

## 版本 2.0.0 (2023-07-10)

### 重大变化

1. **验证系统重构**

   - 使用官方 GitHub Actions JSON Schema 进行验证
   - 集成 actionlint 进行高级语法验证
   - 支持对模板和生成的工作流进行全面验证

2. **YAML 处理引擎改进**

   - 充分利用 ruamel.yaml 的高级功能
   - 保留 YAML 注释和格式
   - 改进多行字符串和特殊字符处理

3. **条件表达式标准化**

   - 使用专用过滤器处理条件表达式
   - 自动标准化操作符周围的空格
   - 始终使用标准的`${{ }}`语法

4. **依赖项管理**
   - 新增依赖项设置和管理模块
   - 自动下载和缓存 JSON Schema
   - 支持安装 actionlint 依赖

### 新功能

1. **命令行接口**

   - 添加了功能完整的命令行工具
   - 支持各种操作，包括生成、更新和设置

2. **自动格式修复**

   - 改进了模板预处理功能
   - 自动修复常见的格式问题
   - 对环境变量引用自动标准化

3. **代码组织和文档**
   - 添加了详细的 README 和变更日志
   - 改进了代码结构和模块化设计
   - 添加了详细的方法和类文档

### 技术改进

1. **代码质量**

   - 减少正则表达式的使用，提高了可维护性
   - 使用标准库提高了代码的可靠性
   - 添加了类型注解，提高了代码可读性

2. **错误处理**

   - 改进了错误报告和记录
   - 添加了更详细的验证错误信息
   - 更好的异常处理和恢复机制

3. **测试和验证**
   - 支持对模板进行试渲染验证
   - 更全面的工作流验证逻辑
   - 模板和渲染分离，提高了测试性

## 版本 1.1.0 (2023-06-10)

### 新功能

1. 添加对代理池管理工作流的支持
2. 添加对仪表盘更新工作流的支持
3. 改进对通知条件的支持

### 错误修复

1. 修复了条件表达式中的格式问题
2. 修复了环境变量引用中的引号问题
3. 改进了 cron 表达式的验证

## 版本 1.0.0 (2023-05-15)

### 初始功能

1. 基本工作流生成功能
2. 支持爬虫和分析器工作流
3. 基本的 YAML 渲染和模板支持
4. 简单的验证机制
